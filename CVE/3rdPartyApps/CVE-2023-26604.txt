URL: https://medium.com/@zenmoviefornotification/saidov-maxim-cve-2023-26604-c1232a526ba7

On one of the pentest project, an unprivileged account was accessed on rhel 8. It was spelled out in sudoers that the command /usr/bin/systemctl status *random_service* could be run from mine user. Coincidentally, the size of my terminal turned out to be small. There is a feature in systemctl which outputs information to pager less instead of cat if the size of the terminal is less than the length of any line output. Pager less has the ability to execute commands, in example you can triger new shell with command !sh.

Why it works?
Rhel 8.x and ubuntu use 20.x systemd 245. System 245 does not check the eUID and UID , which coupled with misconfig in /etc/sudoers allows for local privilege escalation. This works not only with systemctl status, but also with the other commands that systemd supplies.

$ sudo -l
(root) /usr/bin/systemctl status cron.service

<resize screen to a small size>

$ sudo  /usr/bin/systemctl status cron.service

!sh
# whoami
root
